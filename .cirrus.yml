env:
    CIRRUS_CLONE_DEPTH: 1
    CIRRUS_WORKING_DIR: "/tmp/ci"

    ssh1: "ENCRYPTED[216b9abcc86873d7d3220252793bc1433cde0e9674238a5f519f0f053391858fc306c319cb3e285244d3a0009dcf8ae5]"
    ssh2: "ENCRYPTED[1417cb00780f640e025ec5b354c221dd7d050682031161790bc6729f09b76c965451f52c2d6824cdee787577486949c3]"

task:
  name: Build_Upload
  timeout_in: 2h
  container:
    image: alpine/git
    cpu: .7
    memory: 1G
  config_script:
    - sudo git config --global user.name "dopaemon"
    - sudo git config --global user.email "polarisdp@gmail.com"
    - sudo mkdir -p ~/.ssh
    - sudo ssh-keyscan -H github.com >> ~/.ssh/known_hosts
    - sudo touch ~/.ssh/id_ed25519.pub
    - sudo touch ~/.ssh/id_ed25519
    - sudo echo "$ssh2" > ~/.ssh/id_ed25519.pub
    - sudo echo "$ssh1" > ~/.ssh/id_ed25519
  git_script:
    - sudo git clone git@github.com:KernelPanic-OpenSource/KernelPanic-OpenSource.github.io.git ~/Repo
    - sudo git clone https://github.com/dopaemon/KernelPanicPage ~/Repo1
  build_script:
    - sudo cd ~/Repo
    - sudo rm -rvf Packages.bz2
    - sudo git rm Packages.bz2
    - sudo bzip2 -zvk Packages
    - sudo touch loop
    - sudo echo "Loading..." >> loop
    - sudo git add -v -A
    - sudo git commit -sm "Update Packages"
  push_script:
    - sudo cd ~/Repo
    - sudo echo "yes" | git push -f origin master
  loop_script:
    - sudo cd ~/Repo1
    - sudo touch loop
    - sudo echo "Loading..." >> loop
    - sudo git add -v -A
    - sudo git commit -sm "LoopCI"    
    - sudo echo "yes" | git push -f origin master    
